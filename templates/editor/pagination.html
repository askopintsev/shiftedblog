{% if page.paginator.num_pages > 1 %}
{% comment %}Preserve query parameters (e.g., search query) in pagination links{% endcomment %}
{% if query_string %}
    {% with "&"|add:query_string as query_suffix %}
<div class="pagination-wrapper">
    <nav class="pagination-nav" aria-label="Page navigation">
        <ul class="pagination-list">
            {% if page.has_previous %}
                <li class="pagination-item">
                    <a href="?page={{ page.previous_page_number }}{{ query_suffix }}" class="pagination-link pagination-prev" aria-label="Previous page">
                        ‹
                    </a>
                </li>
            {% endif %}
            
            {% if page.number > 3 %}
                <li class="pagination-item">
                    <a href="?page=1{{ query_suffix }}" class="pagination-link">1</a>
                </li>
                {% if page.number > 4 %}
                    <li class="pagination-item pagination-ellipsis">
                        <span class="pagination-ellipsis-text">…</span>
                    </li>
                {% endif %}
            {% endif %}
            
            {% for num in page.paginator.page_range %}
                {% if num == page.number %}
                    <li class="pagination-item">
                        <span class="pagination-link pagination-current" aria-current="page">{{ num }}</span>
                    </li>
                {% elif num >= page.number|add:'-2' and num <= page.number|add:'2' %}
                    <li class="pagination-item">
                        <a href="?page={{ num }}{{ query_suffix }}" class="pagination-link">{{ num }}</a>
                    </li>
                {% endif %}
            {% endfor %}
            
            {% if page.number < page.paginator.num_pages|add:'-2' %}
                {% if page.number < page.paginator.num_pages|add:'-3' %}
                    <li class="pagination-item pagination-ellipsis">
                        <span class="pagination-ellipsis-text">…</span>
                    </li>
                {% endif %}
                <li class="pagination-item">
                    <a href="?page={{ page.paginator.num_pages }}{{ query_suffix }}" class="pagination-link">{{ page.paginator.num_pages }}</a>
                </li>
            {% endif %}
            
            {% if page.has_next %}
                <li class="pagination-item">
                    <a href="?page={{ page.next_page_number }}{{ query_suffix }}" class="pagination-link pagination-next" aria-label="Next page">
                        ›
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>
    {% endwith %}
{% else %}
<div class="pagination-wrapper">
    <nav class="pagination-nav" aria-label="Page navigation">
        <ul class="pagination-list">
            {% if page.has_previous %}
                <li class="pagination-item">
                    <a href="?page={{ page.previous_page_number }}" class="pagination-link pagination-prev" aria-label="Previous page">
                        ‹
                    </a>
                </li>
            {% endif %}
            
            {% if page.number > 3 %}
                <li class="pagination-item">
                    <a href="?page=1" class="pagination-link">1</a>
                </li>
                {% if page.number > 4 %}
                    <li class="pagination-item pagination-ellipsis">
                        <span class="pagination-ellipsis-text">…</span>
                    </li>
                {% endif %}
            {% endif %}
            
            {% for num in page.paginator.page_range %}
                {% if num == page.number %}
                    <li class="pagination-item">
                        <span class="pagination-link pagination-current" aria-current="page">{{ num }}</span>
                    </li>
                {% elif num >= page.number|add:'-2' and num <= page.number|add:'2' %}
                    <li class="pagination-item">
                        <a href="?page={{ num }}" class="pagination-link">{{ num }}</a>
                    </li>
                {% endif %}
            {% endfor %}
            
            {% if page.number < page.paginator.num_pages|add:'-2' %}
                {% if page.number < page.paginator.num_pages|add:'-3' %}
                    <li class="pagination-item pagination-ellipsis">
                        <span class="pagination-ellipsis-text">…</span>
                    </li>
                {% endif %}
                <li class="pagination-item">
                    <a href="?page={{ page.paginator.num_pages }}" class="pagination-link">{{ page.paginator.num_pages }}</a>
                </li>
            {% endif %}
            
            {% if page.has_next %}
                <li class="pagination-item">
                    <a href="?page={{ page.next_page_number }}" class="pagination-link pagination-next" aria-label="Next page">
                        ›
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>
{% endif %}
{% endif %}
