{% extends "blog/base.html" %}
{% load static %}

{% block title %}{{ post.title }} | Shifted Stuff{% endblock %}

{% block extra_head %}
<!-- Open Graph -->
<meta property="og:type" content="article">
<meta property="og:url" content="{{ request.scheme }}://{{ request.get_host }}{{ post.get_absolute_url }}">
<meta property="og:title" content="{{ post.title }}">
{% if post.cover_image %}
<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ post.cover_image.url }}">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
{% endif %}
{% if post.short_description %}
<meta property="og:description" content="{{ post.short_description }}">
{% else %}
{% with body_text=post.body|striptags|truncatechars:160 %}
<meta property="og:description" content="{{ body_text }}">
{% endwith %}
{% endif %}
<meta property="article:published_time" content="{{ post.published|date:'c' }}">
<meta property="article:author" content="{{ post.author.get_full_name|default:post.author }}">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="{{ request.scheme }}://{{ request.get_host }}{{ post.get_absolute_url }}">
<meta name="twitter:title" content="{{ post.title }}">
{% if post.short_description %}
<meta name="twitter:description" content="{{ post.short_description }}">
{% else %}
{% with body_text=post.body|striptags|truncatechars:160 %}
<meta name="twitter:description" content="{{ body_text }}">
{% endwith %}
{% endif %}
{% if post.cover_image %}
<meta name="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{{ post.cover_image.url }}">
{% endif %}
{% endblock extra_head %}

{% block content %}
<div class="post-detail-wrapper">
    <div class="container">
        <div class="post-content-container">
            <div class="post-header">
                <div class="postinfo row row-cols-auto my-0">
                    <p class="col text-muted my-0">{{ post.published|date:'d.m.Y' }}</p>
                    <p class="col text-muted my-0">{{ post.author|upper }}</p>
                </div>
                <div class="tags row row-cols-auto mt-1">
                    {% for tag in post.tags.all %}
                        <div class="col pe-0">
                            <a href="{% url "blog:post_list_by_tag" tag.slug %}">
                                <p class="tag">#{{ tag.name }}</p>
                            </a>
                        </div>
                    {% if not forloop.last %}{% endif %}
                    {% endfor %}
                </div>
            </div>
            <div class="post-title-section">
                <h2 class="post-title">{{ post.title }}</h2>
            </div>
        </div>
    </div>

    <div class="post-cover-image-wrapper">
        <div class="container">
            <div class="post-cover-image-container">
                <img class="post-cover-image" src="{{ post.cover_image.url|urlencode }}" alt="{{ post.title }}">
                {% if post.cover_description %}
                    <div class="post-cover-description">
                        <p class="text-muted mb-0">{{ post.cover_description }}</p>
                    </div>
                {% endif %}
                {% if post.cover_image_credits %}
                    <figure class="post-cover-credits">
                        <figcaption class="blockquote-footer text-center">
                            {{ post.cover_image_credits|safe }}
                        </figcaption>
                    </figure>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="container">
        <div class="post-content-container">
            <div class="post-body-content">
                {{ post.body|safe|linebreaks }}
            </div>

            <div class="post-share-section">
                <div class="share-social text-reset text-decoration-none">
                    {% include "blog/post/social_buttons.html" %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="post-content-container">
        {% if similar_posts %}
        <div class="similar-posts">
            <h3>Рекомендую:</h3>
            {% for post in similar_posts %}
                {% include "blog/post_horizontal_card.html" with post=post %}
            {% empty %}
                <p>Рекомендуемые посты отсутствуют.</p>
            {% endfor %}
        </div>
        {% endif %}
        {% if newest_posts %}
        <div class="similar-posts">
            <h3>Новые посты:</h3>
            {% for post in newest_posts %}
                {% include "blog/post_horizontal_card.html" with post=post %}
            {% empty %}
                <p>Новые посты отсутствуют.</p>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>

<!-- Image Lightbox Modal -->
<div class="image-lightbox-modal" id="imageLightboxModal">
    <div class="image-lightbox-content">
        <img id="lightboxImage" alt="Enlarged image">
    </div>
    <span class="image-lightbox-close" aria-label="Close">&times;</span>
</div>

{% endblock content %}

{% block extra_js %}
<script src="{% static 'js/image-lightbox.js' %}"></script>
{% endblock extra_js %}
